<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç«¶é¦¬ GO / NO-GO åˆ¤å®š</title>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 12px;
    }
    h1 {
      font-size: 20px;
      text-align: center;
      margin: 10px 0 12px;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 12px;
    }
    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    input, select, textarea, button {
      font-size: 16px;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      background: #222;
      color: #fff;
    }
    button.secondary { background:#666; }
    button.danger { background:#b00020; }

    .item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:10px;
      border-radius:10px;
      border:1px solid #eee;
      margin-bottom:6px;
    }
    .result {
      margin-top:10px;
      padding:12px;
      border-radius:10px;
      text-align:center;
      font-weight:bold;
      font-size:18px;
    }
    .go { background:#d4edda; color:#155724; }
    .nogo { background:#f8d7da; color:#721c24; }

    .muted { color:#666; font-size:13px; }
    .divider { height:1px; background:#eee; margin:10px 0; }

    /* ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
    .overlay {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:16px;
    }
    .modal {
      background:#fff;
      border-radius:14px;
      padding:16px;
      width:min(420px,100%);
    }
    .modal h3 { margin:0 0 8px; }
    .modal p { font-size:14px; }
    .modal button { width:100%; margin-top:6px; }
  </style>
</head>

<body>
<h1>ğŸ‡ GO / NO-GO åˆ¤å®š</h1>

<div class="card">
  <div class="muted">é¦¬å</div>
  <input id="horseName" placeholder="ä¾‹ï¼šã€‡ã€‡ã€‡" />

  <div class="divider"></div>

  <div id="checks"></div>

  <div id="judgeResult" class="result nogo">åˆ¤å®šï¼šNO-GOï¼ˆ0 / 10ï¼‰</div>

  <button style="margin-top:10px;" onclick="saveHorse()">ã“ã®é¦¬ã‚’ä¿å­˜</button>
</div>

<div class="card">
  <div style="font-weight:700;">ãƒ¬ãƒ¼ã‚¹ä¸€è¦§</div>
  <div id="horseList" class="muted">ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>
</div>

<div class="card">
  <div class="muted">æŠ•è³‡é‡‘é¡ï¼ˆå††ï¼‰</div>
  <input id="stake" type="number" />

  <div class="muted">æ‰•æˆ»é‡‘ï¼ˆå††ï¼‰</div>
  <input id="payout" type="number" />

  <div id="profitBox" class="result nogo">åæ”¯ï¼š0å††</div>
</div>

<!-- ===== å½¹ã«ç«‹ã£ãŸï¼Ÿ ===== -->
<div class="overlay" id="reviewOverlay">
  <div class="modal">
    <h3>ã“ã®ã‚¢ãƒ—ãƒªã€å½¹ã«ç«‹ã¡ã¾ã—ãŸã‹ï¼Ÿ</h3>
    <p>2é€±é–“ä½¿ã£ã¦ã¿ã¦ã©ã†ã§ã—ãŸã‹ï¼Ÿ</p>
    <button onclick="buy()">å½¹ã«ç«‹ã£ãŸ â†’ ç¶šã‘ãŸã„</button>
    <button class="secondary" onclick="closeReview()">ã¾ã è¿·ã£ã¦ã„ã‚‹</button>
    <button class="danger" onclick="lockApp()">ä»Šå›ã¯ä½¿ã‚ãªã„</button>
  </div>
</div>

<script>
/* ===== è¨­å®š ===== */
const THRESHOLD = 7;
const STORAGE_KEY = "keiba_history_v1";
const INSTALL_KEY = "keiba_install_v1";
const ASKED_KEY = "keiba_reviewAsked_v1";
const LOCK_KEY = "keiba_locked_v1";

/* ===== åˆæœŸåŒ– ===== */
if(!localStorage.getItem(INSTALL_KEY)){
  localStorage.setItem(INSTALL_KEY, Date.now());
}

/* ===== ãƒã‚§ãƒƒã‚¯é …ç›® ===== */
const CHECKS = [
  "å‰èµ°4è§’5ç•ªæ‰‹ä»¥å†…",
  "é€ƒã’ or å…ˆè¡Œå‹",
  "è·é›¢é©æ€§ã‚ã‚Š",
  "ã‚³ãƒ¼ã‚¹å®Ÿç¸¾ã‚ã‚Š",
  "é¨æ‰‹ç¶™ç¶š or å¼·åŒ–",
  "é¦¬ä½“é‡Â±10kgä»¥å†…",
  "äººæ°—1ã€œ5ç•ª",
  "å˜å‹3ã€œ8å€",
  "ä¼‘ã¿æ˜ã‘2èµ°ç›®ä»¥å†…",
  "å‰ã§é‹ã¹ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸"
];

const checksDiv = document.getElementById("checks");
CHECKS.forEach((t,i)=>{
  const d = document.createElement("div");
  d.className="item";
  d.innerHTML = `${t}
    <select onchange="calc()">
      <option value="0">Ã—</option>
      <option value="1">â—‹</option>
    </select>`;
  checksDiv.appendChild(d);
});

/* ===== åˆ¤å®š ===== */
function calc(){
  const selects = document.querySelectorAll("#checks select");
  let score = 0;
  selects.forEach(s=>score+=Number(s.value));
  const box = document.getElementById("judgeResult");
  box.textContent = `åˆ¤å®šï¼š${score>=THRESHOLD?"GO":"NO-GO"}ï¼ˆ${score} / 10ï¼‰`;
  box.className = "result " + (score>=THRESHOLD?"go":"nogo");
}

/* ===== ä¿å­˜ ===== */
function saveHorse(){
  const name = document.getElementById("horseName").value.trim();
  if(!name){ alert("é¦¬åã‚’å…¥ã‚Œã¦ãã ã•ã„"); return; }
  const list = JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
  list.push({ name, time: new Date().toISOString() });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
  renderList();
}

function renderList(){
  const list = JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]");
  const div = document.getElementById("horseList");
  if(list.length===0){ div.textContent="ã¾ã ã‚ã‚Šã¾ã›ã‚“"; return; }
  div.innerHTML = list.map(h=>`ãƒ»${h.name}`).join("<br>");
}

/* ===== åæ”¯ ===== */
function updateProfit(){
  const s = Number(stake.value)||0;
  const p = Number(payout.value)||0;
  const prof = p-s;
  profitBox.textContent = `åæ”¯ï¼š${prof}å††`;
  profitBox.className = "result "+(prof>=0?"go":"nogo");
}
stake.oninput = payout.oninput = updateProfit;

/* ===== ãƒ¬ãƒ“ãƒ¥ãƒ¼ ===== */
function days(){
  return Math.floor((Date.now()-localStorage.getItem(INSTALL_KEY))/(1000*60*60*24));
}
if(days()>=14 && !localStorage.getItem(ASKED_KEY)){
  reviewOverlay.style.display="flex";
}
function closeReview(){
  localStorage.setItem(ASKED_KEY,"1");
  reviewOverlay.style.display="none";
}
function buy(){
  alert("è³¼å…¥ã‚ã‚ŠãŒã¨ã†ï¼ï¼ˆä»®ï¼‰");
  localStorage.setItem(ASKED_KEY,"1");
  reviewOverlay.style.display="none";
}
function lockApp(){
  localStorage.setItem(LOCK_KEY,"1");
  document.querySelectorAll("input,select,button").forEach(e=>e.disabled=true);
  reviewOverlay.style.display="none";
}

/* èµ·å‹•æ™‚ */
renderList();
calc();
updateProfit();
</script>
</body>
</html>